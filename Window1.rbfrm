#tag WindowBegin Window Window1   BackColor       =   16777215   Backdrop        =   ""   CloseButton     =   True   Composite       =   False   Frame           =   0   FullScreen      =   False   HasBackColor    =   False   Height          =   400   ImplicitInstance=   True   LiveResize      =   True   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   False   MaxWidth        =   32000   MenuBar         =   1227343596   MenuBarVisible  =   True   MinHeight       =   64   MinimizeButton  =   True   MinWidth        =   64   Placement       =   0   Resizeable      =   True   Title           =   "Quora"   Visible         =   True   Width           =   600   Begin Label Label1      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   20      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Multiline       =   ""      Scope           =   0      Selectable      =   False      TabIndex        =   0      TabPanelIndex   =   0      Text            =   "User Name:"      TextAlign       =   0      TextColor       =   0      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   14      Transparent     =   False      Underline       =   ""      Visible         =   True      Width           =   85   End   Begin TextField tfUser      AcceptTabs      =   ""      Alignment       =   0      AutoDeactivate  =   True      AutomaticallyCheckSpelling=   False      BackColor       =   16777215      Bold            =   ""      Border          =   True      CueText         =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Format          =   ""      Height          =   22      HelpTag         =   ""      Index           =   -2147483648      Italic          =   ""      Left            =   117      LimitText       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Mask            =   ""      Password        =   ""      ReadOnly        =   ""      Scope           =   0      TabIndex        =   1      TabPanelIndex   =   0      TabStop         =   True      Text            =   "Didier-Szende"      TextColor       =   0      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   14      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   158   End   Begin PushButton pbGetUser      AutoDeactivate  =   True      Bold            =   ""      ButtonStyle     =   0      Cancel          =   ""      Caption         =   "get"      Default         =   True      Enabled         =   False      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   287      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      TabIndex        =   2      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   14      Underline       =   ""      Visible         =   True      Width           =   80   End   Begin Timer Timer1      Height          =   32      Index           =   -2147483648      Left            =   -43      LockedInPosition=   False      Mode            =   2      Period          =   500      Scope           =   0      TabPanelIndex   =   0      Top             =   8      Width           =   32   End   Begin Label Label2      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   379      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Multiline       =   ""      Scope           =   0      Selectable      =   False      TabIndex        =   3      TabPanelIndex   =   0      Text            =   "Page count:"      TextAlign       =   0      TextColor       =   0      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   14      Transparent     =   False      Underline       =   ""      Visible         =   True      Width           =   78   End   Begin Label lbPageCount      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   469      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Multiline       =   ""      Scope           =   0      Selectable      =   False      TabIndex        =   4      TabPanelIndex   =   0      Text            =   "--"      TextAlign       =   0      TextColor       =   0      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   14      Transparent     =   False      Underline       =   ""      Visible         =   True      Width           =   100   End   Begin Listbox lb1      AutoDeactivate  =   True      AutoHideScrollbars=   True      Bold            =   ""      Border          =   True      ColumnCount     =   3      ColumnsResizable=   ""      ColumnWidths    =   40,,0      DataField       =   ""      DataSource      =   ""      DefaultRowHeight=   -1      Enabled         =   True      EnableDrag      =   ""      EnableDragReorder=   ""      GridLinesHorizontal=   0      GridLinesVertical=   0      HasHeading      =   ""      HeadingIndex    =   -1      Height          =   328      HelpTag         =   ""      Hierarchical    =   ""      Index           =   -2147483648      InitialParent   =   ""      InitialValue    =   ""      Italic          =   ""      Left            =   20      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   True      RequiresSelection=   ""      Scope           =   0      ScrollbarHorizontal=   ""      ScrollBarVertical=   True      SelectionType   =   0      TabIndex        =   5      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   46      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   560      _ScrollWidth    =   -1   End   Begin ProgressBar pg1      AutoDeactivate  =   True      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   20      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   False      Maximum         =   100      Scope           =   0      TabPanelIndex   =   0      Top             =   380      Value           =   0      Visible         =   False      Width           =   100   End   Begin myQD qd      Arguments       =   ""      Backend         =   ""      Height          =   32      Index           =   0      Left            =   656      LockedInPosition=   False      Mode            =   0      Scope           =   0      TabPanelIndex   =   0      TimeOut         =   0      Top             =   46      Width           =   32   End   Begin myQD qd      Arguments       =   ""      Backend         =   ""      Height          =   32      Index           =   1      Left            =   656      LockedInPosition=   False      Mode            =   0      Scope           =   0      TabPanelIndex   =   0      TimeOut         =   0      Top             =   90      Width           =   32   End   Begin myQD qd      Arguments       =   ""      Backend         =   ""      Height          =   32      Index           =   2      Left            =   656      LockedInPosition=   False      Mode            =   0      Scope           =   0      TabPanelIndex   =   0      TimeOut         =   0      Top             =   134      Width           =   32   End   Begin myQD qd      Arguments       =   ""      Backend         =   ""      Height          =   32      Index           =   3      Left            =   656      LockedInPosition=   False      Mode            =   0      Scope           =   0      TabPanelIndex   =   0      TimeOut         =   0      Top             =   178      Width           =   32   End   Begin myQD qd      Arguments       =   ""      Backend         =   ""      Height          =   32      Index           =   4      Left            =   656      LockedInPosition=   False      Mode            =   0      Scope           =   0      TabPanelIndex   =   0      TimeOut         =   0      Top             =   222      Width           =   32   EndEnd#tag EndWindow#tag WindowCode	#tag Event		Sub Open()		  me.Width=Screen(0).Width*.8		  me.Height=Screen(0).Height*.8		  		End Sub	#tag EndEvent	#tag Method, Flags = &h0		Sub AddToList(title As String, url As String)		  If ToCFile=Nil Then		    ToCFile=ToCFile.Create(GetFolderItem("TOC.html"))		    ToCFile.Delimiter=EndOfLine.UNIX		    ToCFile.Write(ToCHeader.ReplaceB("XXXX", UserName))		  End If		  		  ToCFile.WriteLine "    <li><a href="""+url+""">"+title+"</a></li>"		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub CloseToC()		  ToCFile.WriteLine TocFooter		  ToCFile.Flush()		  ToCFile.Close()		  ToCFile=Nil		  		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub HandleResult(data As String)		  lb1.Enabled=False		  Dim r As New RegEx		  Dim rm As RegExMatch		  		  //r.Options.Greedy=False		  r.Options.CaseSensitive=False		  r.Options.DotMatchAll=True		  r.Options.TreatTargetAsOneLine=True		  		  r.SearchPattern="<a class='question_link' href='([^']+)' target='_top' action_mousedown='QuestionLinkClickthrough' id='[^']+'><span class='question_text'><span class=[^>]+>([^<]+)</span>"		  log(" • HandleResult")		  log("  --> "+r.SearchPattern)		  rm=r.Search(data)		  While rm<>Nil		    lb1.AddRow("o")		    Dim properURL As String		    properURL="https://www.quora.com"+rm.SubExpressionString(1)+"/answer/"+UserName		    lb1.Cell(lb1.LastIndex, 1)=rm.SubExpressionString(2)		    lb1.Cell(lb1.LastIndex, 2)=properURL		    log(rm.SubExpressionString(2))		    log("  --> "+properURL)		    AddToList(rm.SubExpressionString(2), properURL)		    WorkerRotationIndex=WorkerRotationIndex+1		    If WorkerRotationIndex>4 Then WorkerRotationIndex=0		    qd(WorkerRotationIndex).AddLink(properURL, lb1.LastIndex)		    rm=r.Search(data, rm.SubExpressionStartB(2))		  Wend		  		  lb1.Enabled=True		  pg1.Value=PageNumber		  Window1.Refresh()		  		  r.SearchPattern="<link rel='next' href='/profile/.+?page_id=(\d+)'"		  rm=r.Search(data)		  If rm=Nil Then		    log("No Next Page")		    PageNumber=PageCount+1		  Else		    log("Next page: "+rm.SubExpressionString(1))		    PageNumber=PageNumber+1		  End If		  		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub log(stuff As String)		  If LogFile=Nil Then		    LogFile=LogFile.Create(GetFolderItem("log.txt"))		    LogFile.Delimiter=EndOfLine.UNIX		  End If		  LogFile.WriteLine(stuff)		  LogFile.Flush()		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub LogError(ix As Integer)		  lb1.Cell(ix, 0)="X"		  Window1.Refresh()		  		  pg1.Value=pg1.Value+1		  pg1.Refresh()		  		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub LogSuccess(ix As Integer)		  lb1.Cell(ix, 0)="√"		  Window1.Refresh()		  		  pg1.Value=pg1.Value+1		  pg1.Refresh()		  		End Sub	#tag EndMethod	#tag Property, Flags = &h0		LogFile As TextOutputStream	#tag EndProperty	#tag Property, Flags = &h0		PageCount As Integer = -1	#tag EndProperty	#tag Property, Flags = &h0		PageNumber As Integer = -1	#tag EndProperty	#tag Property, Flags = &h0		ToCFile As TextOutputStream	#tag EndProperty	#tag Property, Flags = &h0		UserName As String	#tag EndProperty	#tag Property, Flags = &h0		WorkerRotationIndex As Integer = -1	#tag EndProperty	#tag Constant, Name = TocFooter, Type = String, Dynamic = False, Default = \"  </ul>\r</body>\r</html>\r", Scope = Public	#tag EndConstant	#tag Constant, Name = ToCHeader, Type = String, Dynamic = False, Default = \"<!DOCTYPE html>\r<html lang\x3D\"en\">\r<head>\r\t<meta charset\x3D\"utf-8\" />\r\t<title>My Answers - XXXX</title>\r</head>\r<body>\r  <ul>", Scope = Public	#tag EndConstant#tag EndWindowCode#tag Events pbGetUser	#tag Event		Sub Action()		  me.Enabled=False		  tfUser.Enabled=False		  Timer1.Mode=0		  Window1.Refresh()		  WorkerRotationIndex=-1		  		  Dim sh As New Shell		  Dim rs As String		  Dim r As New RegEx		  Dim rm As RegExMatch		  		  UserName=tfUser.Text.Trim()		  		  PageNumber=1		  sh.Execute "/usr/bin/curl -s https://www.quora.com/profile/"+UserName+"?page_id=1"		  		  rs=sh.Result.Trim()		  log(rs)		  		  r.Options.Greedy=False		  r.Options.CaseSensitive=False		  r.Options.DotMatchAll=True		  r.Options.TreatTargetAsOneLine=True		  		  log(EndOfLine.UNIX+EndOfLine.UNIX+"Searching for page count")		  r.SearchPattern=">(\d+)</a><a class='pager_link' href='/profile/[-\w]+\?page_id=\d+' rel='next' title='Go To Next Page'>Next"		  rm=r.Search(rs)		  If rm=Nil Then		    MsgBox "Error"+EndOfLine+EndOfLine+"Couldn't get Page Count"		    log("Error"+EndOfLine+EndOfLine+"Couldn't get Page Count")		    PageCount=-1		    Timer1.Mode=2		    tfUser.Enabled=True		    pg1.Visible=False		    Return		  End If		  		  log("Page Count: "+rm.SubExpressionString(1))		  		  PageCount=Val(rm.SubExpressionString(1))		  lbPageCount.Text=rm.SubExpressionString(1)		  pg1.Maximum=PageCount		  pg1.Value=0		  pg1.Visible=True		  Window1.Refresh()		  		  log(EndOfLine.UNIX+EndOfLine.UNIX+"Launching scraping, phase 1")		  		  While PageNumber<10//PageCount		    log(Str(PageNumber)+"/"+Str(PageCount))		    log("/usr/bin/curl -s https://www.quora.com/profile/"+UserName+"?page_id="+Str(PageNumber))		    sh.Execute "/usr/bin/curl -s https://www.quora.com/profile/"+UserName+"?page_id="+Str(PageNumber)		    HandleResult(sh.Result.Trim())		  Wend		  log("End")		  		  MsgBox "Phase 1 complete!"+EndOfLine+EndOfLine+"Now we'll download the answers."		  pg1.Value=0		  pg1.Maximum=lb1.ListCount+1		  Window1.Refresh()		  		  // First create, if necessary the folder -- Name of the User [who]		  // Then create the file link, and start the download.		  		  Dim rootFolder, imgFolder As FolderItem		  rootFolder=GetFolderItem(UserName+"-Answers")		  If Not rootFolder.Exists Then		    rootFolder.CreateAsFolder()		  End If		  imgFolder=rootFolder.Child("Images")		  If Not imgFolder.Exists Then		    imgFolder.CreateAsFolder()		  End If		  		  qd(0).Run(0, rootFolder, imgFolder)		  qd(1).Run(1, rootFolder, imgFolder)		  qd(2).Run(2, rootFolder, imgFolder)		  qd(3).Run(3, rootFolder, imgFolder)		  qd(4).Run(4, rootFolder, imgFolder)		  		  Dim w As Integer		  w=qd(0).StillWorking+qd(1).StillWorking+ qd(2).StillWorking+qd(3).StillWorking+qd(4).StillWorking		  While w>0		    qd(0).Poll()		    qd(1).Poll()		    qd(2).Poll()		    qd(3).Poll()		    qd(4).Poll()		    w=qd(0).StillWorking+qd(1).StillWorking+ qd(2).StillWorking+qd(3).StillWorking+qd(4).StillWorking		  Wend		  		  MsgBox "Phase 2 done"		  		  		  Timer1.Mode=2		  tfUser.Enabled=True		  pg1.Visible=False		  CloseToC()		  		End Sub	#tag EndEvent#tag EndEvents#tag Events Timer1	#tag Event		Sub Action()		  If tfUser.Text.Trim()="" Then		    pbGetUser.Enabled=False		  Else		    pbGetUser.Enabled=True		  End If		  		End Sub	#tag EndEvent#tag EndEvents